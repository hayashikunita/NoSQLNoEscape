SQL コマンド チートシート (最小限で超わかりやすく)
===============================================

1. まず覚える 5 行 (SELECT)
- SELECT 列 FROM テーブル;
- WHERE 条件: WHERE id = 10 AND status = 'open'
- ORDER BY: ORDER BY 列 ASC|DESC
- LIMIT: LIMIT 10 [OFFSET 0] / SQL Server: TOP 10
- 別名: SELECT 列 AS 別名, テーブル AS t FROM テーブル AS t;

2. CRUD 超基本
- 追加 1 行: INSERT INTO テーブル (a, b) VALUES (1, 'x');
- 追加 複数: INSERT INTO テーブル (a, b) VALUES (1,'x'), (2,'y');
- 更新: UPDATE テーブル SET a = 2 WHERE id = 1;
- 削除: DELETE FROM テーブル WHERE id = 1; -- WHERE 無しは全削除

3. WHERE で使う代表句
- 比較: =, <>, >, <, >=, <=
- 部分一致: LIKE 'A%'; -- % 任意長, _ 1 文字
- 集合: IN (値1, 値2)
- 範囲: BETWEEN 下限 AND 上限
- 論理: AND / OR / NOT

4. 集計の定番 3 手
- COUNT/SUM/AVG/MIN/MAX: SELECT COUNT(*) FROM t;
- GROUP BY: SELECT dept, COUNT(*) FROM emp GROUP BY dept;
- HAVING: SELECT dept, COUNT(*) c FROM emp GROUP BY dept HAVING c >= 3;

5. JOIN はこれだけで動く
- 内部: SELECT ... FROM A INNER JOIN B ON A.id = B.a_id;
- 左外: SELECT ... FROM A LEFT JOIN B ON A.id = B.a_id; -- A を残す
- USING: SELECT ... FROM A JOIN B USING (共通列);

6. サブクエリと集合
- IN サブクエリ: WHERE user_id IN (SELECT id FROM users WHERE active);
- EXISTS: WHERE EXISTS (SELECT 1 FROM orders o WHERE o.user_id = u.id);
- UNION: クエリ1 UNION [ALL] クエリ2; -- ALL は重複保持

7. 文字列/日付のよく使う形
- 連結: CONCAT(a, b) または a || b
- 部分: SUBSTR(col, 1, 3) / SUBSTRING(col FROM 1 FOR 3)
- 長さ: LENGTH(col) (MySQL は CHAR_LENGTH も)
- 日付: CURRENT_DATE, CURRENT_TIMESTAMP, DATE(col)

8. テーブル定義 最短サンプル
CREATE TABLE items (
  id SERIAL PRIMARY KEY,        -- MySQL: INT AUTO_INCREMENT
  name VARCHAR(100) NOT NULL,
  price INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
-- 列追加: ALTER TABLE items ADD COLUMN note TEXT;
-- 削除: DROP TABLE items;

9. 制約とインデックスの最少セット
- 制約: PRIMARY KEY / UNIQUE / NOT NULL / CHECK / FOREIGN KEY (... ON DELETE/UPDATE CASCADE|SET NULL|RESTRICT)
- インデックス追加: CREATE INDEX idx_items_price ON items(price);
- インデックス削除: DROP INDEX idx_items_price; (MySQL: DROP INDEX idx ON items)

10. トランザクション 3 コマンド
- BEGIN; / START TRANSACTION;
- COMMIT;   -- 確定
- ROLLBACK; -- 取り消し

11. 権限 (DB により差異あり)
- 付与: GRANT SELECT, INSERT ON table TO user;
- 取消: REVOKE SELECT, INSERT ON table FROM user;

12. CSV ロード例
- PostgreSQL: \copy items FROM 'file.csv' CSV HEADER;
- MySQL: LOAD DATA INFILE 'file.csv' INTO TABLE items FIELDS TERMINATED BY ',' ENCLOSED BY '"' IGNORE 1 LINES;

最後にチェック (事故防止 5 点)
- UPDATE/DELETE に WHERE を付けたか
- COMMIT/ROLLBACK を忘れていないか
- NULL 比較で = を使っていないか (IS NULL を使う)
- LIKE の %/_ を入れたか
- ORDER BY と LIMIT で意図通りの順序・件数か
